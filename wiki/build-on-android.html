<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="https://decentralised-project.github.io/favicon.png" />
    <link rel="apple-touch-icon" type="image/png" href="https://decentralised-project.github.io/favicon.png" />
    <link rel="icon" type="image/png" href="https://decentralised-project.github.io/favicon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <title>Build DC on Android - Decentralised Project</title>

    <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/dc.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

    <div class="header"></div>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="title-block">
                    <div>
                        <span>
                            <img src="/images/dc-logo.png" alt="" class="hidden-xs" />
                        </span>
                        <span class="padleft20">Decentralised</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">

                <nav class="navbar navbar-default">
                    <div class="container-fluid">
                        <!-- Brand and toggle get grouped for better mobile display -->
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                        </div>

                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav">
                                <li>
                                    <a href="/">Home</a>
                                </li>

                                <li class="active">
                                    <a href="/wiki.html">Wiki</a>
                                </li>

                                <li>
                                    <a href="/download.html">Download</a>
                                </li>
                            </ul>
                        </div>

                    </div>
                </nav>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h2>Build Decentralised on Android</h2>
                <div class="shaded-box">
                    <p>
                        These build instructions were tested as they were written on an installation of ubuntu 16.04 LTS 64-bit running on VirtualBox.
                    </p>

                    <p>
                        Before you start building for Android, follow the <a href="/wiki/build-on-ubuntu.html" title="ubuntu build instructions">ubuntu build instructions</a>
                        to ensure the environment is set up correctly.
                    </p>

                    <p>
                        <strong>IMPORTANT</strong>: Check you are running 64-bit ubuntu, 32-bit will fail.
                    </p>
                </div>

                <h3>Preparing the environment</h3>
                <div class="shaded-box">
                    <ul>
                        <li>
                            The following step doesn't appear to work with Firefox at the time of writing, so you might need to
                            install <a href="https://apps.ubuntu.com/cat/applications/chromium-browser/" title="Chromium Browser">Chromium Browser</a>.
                        </li>
                        <li>
                            Download <strong>Android Studio</strong> for Linux from
                            <a href="https://developer.android.com/sdk" title="Android Studio and SDK">https://developer.android.com/sdk</a>
                            <br />
                            Follow the <a href="https://developer.android.com/sdk/installing">installation instructions</a> that appear after the download has started.
                            <br />
                            <i>Tip: If the apt-get install for 64-bit systems fails, try removing lib32bz2-1.0 from the command.</i>
                        </li>
                        <li>
                            Open Android Studio, go to Configure > SDK Manager and install Android API 10.
                        </li>
                        <li>
                            Download <strong>Android Native Development Kit (NDK)</strong> for Linux from
                            <a href="https://developer.android.com/ndk/downloads" title="Android NDK">https://developer.android.com/ndk/downloads</a>
                        </li>
                        <li>
                            Extract the NDK zip file into a folder next to where you installed Android Studio. eg...
<pre>
sudo unzip android-ndk-r11c-linux-x86_64.zip /usr/local/android-ndk
</pre>
                        </li>
                        <li>
                            Set the environment variables below (altering the paths if necessary, to where you installed the SDK and NDK)
                            <br />
                            Note: You can see where the SDK was installed, by opening Android Studio > Configure > SDK Manager
<pre>
export ANDROID_SDK=/home/[YourUsername]/Android/Sdk
export ANDROID_NDK=/usr/local/android-ndk/android-ndk-r11c
export PATH=%ANDROID_SDK%/tools:%ANDROID_SDK%/platform-tools:%ANDROID_NDK%:$PATH
</pre>
                        </li>
                    </ul>
                </div>

                <h3>Build Ogre Dependencies</h3>
                <div class="shaded-box">
                    <ul>
                        <li>
                            Assuming you still have a <i>~/Decentralised</i> folder from following the
                            <a href="/wiki/build-on-ubuntu.html" title="ubuntu build instructions">ubuntu build instructions</a>,
                            open a terminal and cd into the folder.
                        </li>
                        <li>
                            The Ogre dependencies have to be built for Android, so clone a copy of the source code by typing ...
<pre>
hg clone https://bitbucket.org/cabalistic/ogredeps ogredeps
</pre>
                        </li>
                        <li>
                            cd into the ogredeps/build directory, and execute CMake as below.
                            <br />
                            Notes:
                            <ul>
                                <li>
                                    ANDROID_ABI is usually armeabi-v7a
                                </li>
                                <li>
                                    ANDROID_NATIVE_API_LEVEL should match whatever API level you downloaded via the SDK utilities
                                </li>
                                <li>
                                    ANDROID_TOOLCHAIN_NAME should match the toolchain (i.e., build system) you wish to use from %ANDROID_NDK%\toolchains
                                </li>
                            </ul>
<pre>
cd ogredeps
mkdir build
cd build
cmake -G "Unix Makefiles" -DCMAKE_TOOLCHAIN_FILE="../cmake/android.toolchain.cmake" \
   -DANDROID_ABI=armeabi-v7a -DANDROID_NATIVE_API_LEVEL=10 \
   -DANDROID_TOOLCHAIN_NAME=arm-linux-androideabi-4.9 ..
make
sudo make install
</pre>
                        </li>
                    </ul>
                </div>

                <h3>Build Ogre</h3>
                <div class="shaded-box">
                    <ul>
                        <li>
                            Open a terminal and cd into the <i>~/Decentralised</i> folder.
                        </li>
                        <li>
                            You should already have the Ogre source from the ubuntu build, but if not, run the command below.
<pre>
hg clone https://bitbucket.org/sinbad/ogre ogre -r v1-9
</pre>
                        </li>
                        <li>
                            The file <i>ogre/CMake/toolchain/android.toolchain.cmake</i> is older than the one in the ogredeps project.
                            <br />
                            Copy the file from <i>ogredeps/cmake/android.toolchain.cmake</i> and replace the older Ogre version, to avoid errors.
                        </li>
                        <li>
                            Copy the file <i>%ANDROID_NDK%/sources/android/cpufeatures/cpu-features.h</i>
                            <br/>
                            to <i>%ANDROID_NDK%/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/user/include</i>
                        </li>
                        <li>
                            cd into the ogre folder, create a build folder, and cd into it, as below.
<pre>
cd ogre
mkdir build
cd build
</pre>
                        </li>
                        <li>
                            Run CMake as before, but this time including the path to the installed ogre dependencies.
<pre>
cmake -G "Unix Makefiles" -DCMAKE_TOOLCHAIN_FILE="../CMake/toolchain/android.toolchain.cmake" \
   -DOGRE_DEPENDENCIES_DIR="%ANDROID_NDK%/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/user" \
   -DANDROID_ABI=armeabi-v7a -DANDROID_NATIVE_API_LEVEL=10 -DANDROID_TOOLCHAIN_NAME=arm-linux-androideabi-4.9 ..
make
</pre>
                        </li>
                        <li>
                            TODO: Fix for DummyJNI link issue.
                        </li>
                        <li>
                            Download <strong>Apache Ant</strong> from <a href="http://ant.apache.org/bindownload.cgi">http://ant.apache.org/bindownload.cgi</a>.
                            <br/>
                            Unzip, copy the folder to /usr/local and add the bin folder to the PATH environment variable.
<pre>
export PATH=/usr/local/apache-ant/bin:$PATH    
</pre>
                        </li>
                    </ul>
                </div>

            </div>
        </div>

    </div>

    <a href="https://github.com/decentralised-project/dc-viewer" target="_blank">
        <img class="git-corner" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png">
    </a>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/javascripts/bootstrap.min.js"></script>
</body>
</html>
